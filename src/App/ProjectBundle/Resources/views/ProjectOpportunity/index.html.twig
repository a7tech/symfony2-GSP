{% extends 'AppProjectBundle:ProjectOpportunity:layout.html.twig' %}

{% block actions_main %}

    <div class="action-view">
        <div class="row">
            <div class="row-align">
                <table id="datatable" class="table table-bordered table-striped" data-entity-list-route="{{ path('backend_project_opportunity_datatables') }}">
                    <thead>
                    <tr>
                        <th style="width:20px">Id</th>
                        <th>{{ 'name'|trans({}, 'Common') }}</th>
                        <th>{{ 'vendor_company'|trans({}, 'AccountProfile') }}</th>
                        <th>{{ 'owner'|trans({}, 'Project') }}</th>
                        <th>{{ 'milestone'|trans({}, 'Project') }}</th>
                        <th>{{ 'opportunity.expected_value'|trans({}, 'Project') }}</th>
                        <th>{{ 'currency'|trans({}, 'Currency') }}</th>
                        <th>{{ 'client'|trans({}, 'Project') }}</th>
                        <th>{{ 'opportunity.commision'|trans({}, 'Project') }}</th>
                        <th>{{ 'opportunity.expected_close_date'|trans({}, 'Project') }}</th>
                        <th>{{ 'project'|trans({}, 'Project') }}</th>
                        <th>{{ 'opportunity.progress'|trans({}, 'Project') }}</th>
                    </tr>
                    </thead>
                    {% if entities %}
                    <tbody>
                    {% for entity in entities %}
                        <tr id="{{ entity.id }}">
                            <td><a href="{{ path('backend_project_opportunity_show', {id: entity.id}) }}">{{ entity.id }}</a></td>
                            <td><a href="{{ path('backend_project_opportunity_edit', { 'id': entity.id }) }}">{{ entity.name }}</a></td>
                            <td>
                                {% if entity.accountProfile|length>0 %}
                                    {{ entity.accountProfile.name }}
                                {% endif %}
                            </td>
                            <td>
                                {% if entity.owner%}
                                    {{ entity.owner.person.firstName }}
                                {% endif %}
                            </td>
                            <td>
                                {% set status_info = statusInfo(constant('STATUS_GROUP_NAME', entity.milestone), entity.milestone.status) %}
                                <span {% if status_info.color is not empty %}style="color: {{ status_info.color }}"{% endif %}>{{ entity.milestone.name }}</span>
                            </td>
                            <td>{{ entity.expectedValue }}</td>
                            <td>{{ entity.currency.name }} {{ entity.currency.symbol }} {{ entity.currency.code }}</td>
                            <td>
                                {% if entity.client%}
                                    <a href="{{ path('backend_person_show', {'id': entity.client.id}) }}">{{ entity.client.firstName }} {{ entity.client.lastName }} (id {{ entity.client.id }})</a>
                                {% endif %}
                            </td>
                            <td>{{ entity.commision }}</td>
                            <td>{% if entity.expectedDate %}{{ entity.expectedDate|date('Y-m-d H:i:s') }}{% endif %}</td>
                            <td>
                                {% if entity.project %}
                                    <a href="{{ path('backend_project_show', {'id': entity.project.id}) }}">{{ entity.project }}</a>
                                {% endif %}
                            </td>
                            <td>{{ entity.progress*100 }}%</td>
                        </tr>
                    {% endfor %}
                    </tbody>
                    {% endif %}
                </table>
        </div>
        </div>
    </div>
{% endblock %}

{% block user_js %}
    <script type="text/javascript" src="{{ asset('tabletools/js/ZeroClipboard.js') }}"></script>
    <script type="text/javascript" src="{{ asset('tabletools/js/TableTools.js') }}"></script>
    <script type="text/javascript" src="{{ asset('tabletools/js/paging.js') }}"></script>
    <script type="text/javascript" src="{{ asset('bundles/appbackend/js/table.js') }}"></script>
{% endblock %}